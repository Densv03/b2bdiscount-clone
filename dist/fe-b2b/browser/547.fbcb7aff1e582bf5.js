"use strict";(self.webpackChunkfe_b2b=self.webpackChunkfe_b2b||[]).push([[547],{90547:(_,g,s)=>{s.r(g),s.d(g,{AdminTradebidModule:()=>k});var S=s(69808),O=s(63807),x=s(15861),b=s(97582),p=s(14739),P=s(49388),y=s(77579),L=s(39841),M=s(39300),j=s(95577),F=s(50590),T=s(68675),N=s(63900),v=s(54004),a=s(44987),Q=s(31598),Y=s(89925),D=s(92340),R=s(4265),l=(()=>{return(r=l||(l={})).tradebid="tradebid",r.offers="offers",r.market="market",l;var r})(),C=s(1218),i=s(5e3),m=s(18505),A=s(96931),U=s(35237),z=s(14835),B=s(56913);function u(r){return r.photos&&r.photos.length?r.photos[0].lg:null}let f=class{constructor(e,t,o,n){this._apiService=e,this._offersQuery=t,this._offersStore=o,this._hotToastService=n,this._endpoint="offers/"}removeAllOffers(){return this._apiService.delete("offers/delete")}getContainerLocation(e){return this._apiService.get(`container/location?${e}`)}getAllOffersCount(){return this._offersQuery.selectAllOffersCount$}getSeaLines(){const{seaLines:e}=this._offersQuery.getValue();return e.length||this._apiService.get("seaLines").pipe((0,a.t)(this)).subscribe(t=>{this._offersStore.update({seaLines:t})}),this._offersQuery.selectSeaLines$}markAsSold(e){this._apiService.post(`offer/${e}/status/update`,{status:"sold"}).pipe((0,a.t)(this),this._hotToastService.observe({loading:"Offer status updating...",success:"Offer status updated successfully!",error:"Offer status updating failed!"})).subscribe()}deleteOfferSub(e){return this._apiService.delete(`offer/${e}/delete`).pipe((0,a.t)(this))}deleteOfferById(e,t){return this._apiService.delete(`offer/${e}/delete`,t)}getOfferById(e){return this._apiService.get(`offer/${e}/`).pipe((0,m.b)(t=>{this._offersStore.update({offer:t})}))}getMyOffers(){return this._apiService.get("my/offers/").pipe((0,a.t)(this)).subscribe(e=>{this._offersStore.update({myOffers:e.map(t=>({...t,previewPhoto:u(t)}))})}),this._offersQuery.selectMyOffers$}getOffers(e=""){return this._apiService.get("tradeBid/get-rfq-admin"+e+"&hideCompleted=true").pipe((0,a.t)(this),(0,v.U)(t=>{const{rfqList:o,totalCount:n}=t,c=o.map(h=>({...h,previewPhoto:u(h)}));return this._offersStore.update({allOffers:c,allOffersCount:n}),[...c]}))}getActiveOffers(){return this._apiService.get("offers?hideSold=true").pipe((0,a.t)(this),(0,v.U)(e=>{const{offers:t,totalCount:o}=e,n=t.map(c=>({...c,previewPhoto:u(c)}));return this._offersStore.update({allOffers:n,allOffersCount:o}),[...n]}))}getSavedOffers(){return this._apiService.get("my/offers/favourites").subscribe(t=>{this._offersStore.update({savedOffers:t.map(o=>({...o,previewPhoto:u(o)}))})}),this._offersQuery.selectSavedOffers$}createOffer(e){return this._apiService.post("offer/create",e)}updateOffer(e,t){return this._apiService.put(`offer/${t}/update`,e)}addFavoriteOffer(e){return this._apiService.post(`user/favourites/${e}/add`,{}).pipe((0,m.b)(()=>{this._offersStore.update({allOffers:this._offersStore.getValue().allOffers.map(t=>({...t,isSaved:t._id===e||t.isSaved}))})}))}removeFavoriteOffer(e){return this._apiService.delete(`user/favourites/${e}/remove`).pipe((0,m.b)(()=>{const{savedOffers:t,allOffers:o}=this._offersQuery.getValue();this._offersStore.update({savedOffers:t.filter(n=>n._id!==e),allOffers:o.map(n=>({...n,isSaved:n._id!==e&&n.isSaved}))})}))}approveOffer(e){return this._apiService.post("tradeBid/rfq-approval",{id:e})}declineOffer(e,t){return this._apiService.post("tradebid/rfq-rejection",{id:e,reasonForReject:t})}};f.\u0275fac=function(e){return new(e||f)(i.LFG(A.s),i.LFG(U.Y),i.LFG(z.m),i.LFG(B.jE))},f.\u0275prov=i.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f=(0,b.gn)([(0,a.c)()],f);var I=s(36521),Z=s(82021),$=s(48966),E=s(56838),G=s(55454),J=s(93637);let d=class{constructor(e,t,o,n,c,h,w){this.adminTradeBidService=e,this._offersService=t,this._hotToastrService=o,this._apiService=n,this._usersService=c,this.dialog=h,this.mixpanelService=w,this.listType=l,this.pageSubject=new y.x,this.forceSubject=new y.x,this.b2bNgxButtonThemeEnum=p.n,this.b2bNgxLinkThemeEnum=P.L,this.offers$=this._getOffers$(),this.menuOptions=this._getMenuOptions(),this.totalCount$=this._offersService.getAllOffersCount(),this._usersService.getToken$().pipe((0,F.P)()).subscribe(q=>{this.token=q,this.openConnection()})}ngOnInit(){}export(){this._apiService.get("get-user-report").pipe((0,a.t)(this)).subscribe()}removeAllOffers(){this._offersService.removeAllOffers().pipe((0,a.t)(this),this._hotToastrService.observe({loading:"Offers is deleting...",success:"Offers successfully deleted",error:"Offers deleting failed"})).subscribe()}_getOffers$(){const e=this.pageSubject.asObservable().pipe((0,T.O)(1)),t=this.forceSubject.asObservable().pipe((0,T.O)(!0));return(0,L.a)([e,t]).pipe((0,N.w)(([o])=>this.adminTradeBidService.getOffers("?offset="+10*(o-1))),(0,v.U)(o=>o))}setPage(e){this.pageSubject.next(e)}_getMenuOptions(){var e=this;return[{label:"Delete",icon:"delete-red",onClick:t=>{this.dialog.open(R.z,{data:{title:"Delete product",message:"Are you sure you want to delete this product?",confirmButtonText:"Delete",confirmButtonTheme:p.n.BACKGROUND_RED,cancelButtonText:"Cancel",cancelButtonTheme:p.n.OUTLINE_BLACK}}).afterClosed().pipe((0,M.h)(o=>!!o),(0,j.z)(()=>this._offersService.deleteRfq(t._id).pipe((0,a.t)(this),this._hotToastrService.observe({loading:"Offer deleting",success:"Offer deleted",error:"Offer deleting failed"})))).subscribe(()=>{this.forceSubject.next(!0)})}},{label:"approve by admin",icon:"check",onClick:t=>{console.log("click"),this.adminTradeBidService.approveOffer(t._id).pipe((0,a.t)(this)).subscribe(()=>{this.forceSubject.next(!0),this._hotToastrService.success("approved"),this.mixpanelService.track("New RFQ posted",{"Product Sector":t.category[0].name,Destination:(0,C.oY)(t.destination.to)})})}},{label:"decline by admin",icon:"cross",onClick:t=>{this.startChat(t.user,t._id),this.dialog.open(Q.S,{data:{chatUsers:t.chatStarted},width:"40vw",height:"auto",minHeight:"0"}).afterClosed().pipe((0,a.t)(this)).subscribe(function(){var o=(0,x.Z)(function*(n){n&&(yield e.openConnection(),e.adminTradeBidService.declineOffer(t._id,n).pipe((0,a.t)(e)).subscribe(()=>{e.sendMessage(t.user,t._id,n),e.closeConnection(),e.forceSubject.next(!0),e._hotToastrService.success("declined"),e.mixpanelService.track("Product declined",{"Product Category":t.category.name,"Supplier's Country":(0,C.oY)(t.destination.to),"Product Count":t.amount.count,"Deletion Date":(new Date).toISOString()})}))});return function(n){return o.apply(this,arguments)}}())}}]}openConnection(){this._socket=(0,Y.io)(D.N.apiUrl,{path:"/chat",auth:{token:this.token}})}startChat(e,t){this._socket.emit("start_chat",{userId:e,offerId:t})}sendMessage(e,t,o){!o||this._socket.emit("message",{type:"text",body:o,userId:e,offerId:t})}closeConnection(){this._socket&&this._socket.disconnect()}};d.\u0275fac=function(e){return new(e||d)(i.Y36(f),i.Y36(I.b),i.Y36(B.jE),i.Y36(A.s),i.Y36(Z.K),i.Y36($.uw),i.Y36(E.h))},d.\u0275cmp=i.Xpm({type:d,selectors:[["b2b-admin-tradebid"]],decls:5,vars:9,consts:[[1,"admin-offers"],[3,"offers","menuOptions","listType"],[3,"length","perPage","togglePageNumber"]],template:function(e,t){1&e&&(i.TgZ(0,"div",0),i._UZ(1,"app-admin-offers-list",1),i.ALo(2,"async"),i.TgZ(3,"b2b-ngx-pagination",2),i.NdJ("togglePageNumber",function(n){return t.setPage(n)}),i.ALo(4,"async"),i.qZA()()),2&e&&(i.xp6(1),i.Q6J("offers",i.lcZ(2,5,t.offers$))("menuOptions",t.menuOptions)("listType",t.listType.tradebid),i.xp6(2),i.Q6J("length",i.lcZ(4,7,t.totalCount$))("perPage",10))},dependencies:[G.N,J.Q,S.Ov],styles:[".admin-offers[_ngcontent-%COMP%]{padding:20px}"]}),d=(0,b.gn)([(0,a.c)()],d);const K=[{path:"",component:d}];let V=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=i.oAB({type:r}),r.\u0275inj=i.cJS({imports:[O.Bz.forChild(K),O.Bz]}),r})();var H=s(1975),W=s(65297),X=s(98611);let k=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=i.oAB({type:r}),r.\u0275inj=i.cJS({imports:[S.ez,V,H.l,W.z,X.v,$.Is]}),r})()}}]);