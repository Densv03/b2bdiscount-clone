"use strict";(self.webpackChunkfe_b2b=self.webpackChunkfe_b2b||[]).push([[296],{70296:(ut,T,n)=>{n.r(T),n.d(T,{AdminBlogPostModule:()=>ct});var A=n(69808),g=n(93075),B=n(59026),_=n(16749),I=n(17354),R=n(38831),S=n(94418),U=n(97631),E=n(29345),h=n(63807),G=n(97582),D=n(14739),J=n(20592),f=n(44987),L=n(4128),Q=n(39841),Y=n(78372),F=n(71884),j=n(68675),O=n(63900),N=n(50590),M=n(39300),K=n(54004),$=n(2613),z=n(70771),V=n(92340),t=n(5e3),W=n(26402),X=n(56913),H=n(38985),w=n(21729),k=n(70159),q=n(97567),tt=n(13114),et=n(5214),nt=n(11070),it=n(29291),Z=n(19129);function ot(o,i){if(1&o&&(t.TgZ(0,"div",20)(1,"div",21),t._UZ(2,"input",22),t.qZA(),t.TgZ(3,"div",21),t._UZ(4,"input",23),t.qZA(),t.TgZ(5,"div",21),t._UZ(6,"input",24),t.qZA(),t.TgZ(7,"div",21),t._UZ(8,"input",25),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.Q6J("theme",e.b2bNgxInputThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("theme",e.b2bNgxInputThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("theme",e.b2bNgxInputThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("theme",e.b2bNgxInputThemeEnum.BACKGROUND_GRAY)}}function at(o,i){1&o&&(t.TgZ(0,"div",26),t._uU(1," To change alts for picture, edit this post after creation "),t.qZA())}var m=(()=>{return(o=m||(m={}))[o.CREATE=0]="CREATE",o[o.EDIT=1]="EDIT",m;var o})();const lt={editable:!0,spellcheck:!0,height:"auto",minHeight:"200px",translate:"yes",enableToolbar:!0,showToolbar:!0,placeholder:"Enter text here...",fonts:[{class:"arial",name:"Arial"},{class:"times-new-roman",name:"Times New Roman"},{class:"calibri",name:"Calibri"},{class:"comic-sans-ms",name:"Comic Sans MS"}],sanitize:!0,toolbarPosition:"top"};let p=class{constructor(i,e,a,r,s,l){this.formBuilder=i,this.categoriesService=e,this.hotToastService=a,this.activatedRoute=r,this.blogService=s,this.router=l,this.b2bNgxInputThemeEnum=z.T,this.blogActionEnum=m,this.searchControl=new g.NI,this.b2bNgxSelectThemeEnum=J.B,this.b2bNgxButtonThemeEnum=D.n,this.editorConfig=lt,this.level1Categories=[],this.level2Categories=[],this.searchedOptions$=this.getSearchedOptions()}ngOnInit(){this.blogAction="create"===this.activatedRoute.snapshot.params.id?m.CREATE:m.EDIT,this.getFormGroup(),this.blogAction===m.EDIT&&this.updateArticle(),this.setLevel1Categories(),this.setLevel2Categories()}getSearchedOptions(){return this.searchControl.valueChanges.pipe((0,Y.b)(1e3),(0,F.x)(),(0,j.O)(""),(0,O.w)(i=>this.blogService.getTags(i)))}setSearch(i){this.searchControl.setValue(i)}onSubmit(i){if(!this.formGroup.valid)return;let{_id:e,level2Category:a,title:r,country:s,description:l,author:b,image:v,shortDescription:u,alt1:x,alt2:gt,alt3:mt,alt4:dt}=i;const pt=e?m.EDIT:m.CREATE,d={title:r,description:l,author:b,country:s,category:a,shortDescription:u};l=l.replaceAll("<a",'<a rel="nofollow"'),l=l.replaceAll("<a",'<a target="_blank""');const C=[x,gt,mt,dt];let y=0;if(d.description=l.split(""),C[0])for(let c=0;c<l.length-6;++c)"<"===l[c]&&"i"===l[c+1]&&"m"===l[c+2]&&"g"===l[c+3]&&" "===l[c+4]&&"a"===l[c+5]&&C[y]&&(d.description.splice(c,6,`<img alt="${C[y]}"`),y++,c+=3);C.forEach((c,P)=>{c&&(d[`alt${P+1}`]=c)}),d.description=d.description.join(""),pt===m.CREATE?(d.description=l.replace(/<p class="MsoNormal">&#160;<\/p>|<p class="MsoNormal"><b><span>&#160;<\/span><\/b><\/p>/g,"<div><br></div>"),this.blogService.createBlog(d).pipe(this.hotToastService.observe({loading:"Post creating...",success:"Post created successfully!",error:"Post creation failed!"})).subscribe(P=>{this.blogService.uploadImage(this.getFormData({image:v}),P._id).pipe(this.hotToastService.observe({loading:"Uploading images...",success:"Images uploaded successfully!",error:"Images uploading failed!"})).subscribe(()=>this.router.navigate(["/admin/blog"]))})):(0,L.D)([this.blogService.updateBlog(e,d).pipe((0,N.P)()),this.blogService.uploadImage(this.getFormData({image:v}),e).pipe((0,N.P)())]).pipe(this.hotToastService.observe({loading:"Post updating...",success:"Post updated successfully!",error:"Post updating failed!"})).subscribe(()=>this.router.navigate(["/admin/blog"]))}getFormGroup(){this.formGroup=this.formBuilder.group({_id:null,title:"",description:"",author:"",image:"",country:[null],tags:[[]],level1Category:[null],level2Category:[null],shortDescription:["",g.kI.maxLength(140)],alt1:[null],alt2:[null],alt3:[null],alt4:[null]})}setLevel1Categories(){this.categoriesService.getWikiCategories().pipe((0,f.t)(this)).subscribe(i=>{this.level1Categories=i})}setLevel2Categories(){this.formGroup.get("level1Category").valueChanges.pipe((0,f.t)(this),(0,M.h)(i=>!!i)).subscribe(i=>{var e;this.level2Categories=null===(e=this.level1Categories.find(a=>a._id===i))||void 0===e?void 0:e.children})}getFormData(i){const e=new FormData;return Object.entries(i).filter(([,a])=>!!a).forEach(([a,r])=>{if("image"===a)Array.from(r).forEach(s=>{e.append(a,s)});else if(Array.isArray(r))r.filter(s=>!!s).forEach(s=>{e.append(a,s)});else if("object"==typeof r&&r)for(const s in r){const l=`${a}${(0,$.f)(s)}`;e.append(l,r[s])}else e.append(a,r)}),e}updateArticle(){const i=this.activatedRoute.paramMap.pipe((0,K.U)(a=>a.get("id")),(0,M.h)(a=>!!a),(0,O.w)(a=>this.blogService.getArticleById(a))),e=this.categoriesService.getWikiCategories();(0,Q.a)([i,e]).pipe((0,f.t)(this)).subscribe(([a,r])=>{var s,l;const b=a.category,v=null===(s=r.find(u=>null==u?void 0:u.children.find(x=>x._id===b)))||void 0===s?void 0:s._id;this.formGroup.patchValue({...a.blog,image:[V.N.apiUrl+(null===(l=a.blog.image)||void 0===l?void 0:l.lg)],level1Category:v,level2Category:b})})}};p.\u0275fac=function(i){return new(i||p)(t.Y36(g.qu),t.Y36(W.G),t.Y36(X.jE),t.Y36(h.gz),t.Y36(H.Z),t.Y36(h.F0))},p.\u0275cmp=t.Xpm({type:p,selectors:[["b2b-admin-blog-post"]],decls:27,vars:24,consts:[[1,"admin-article",3,"formGroup","ngSubmit"],[1,"admin-article__label"],["formControlName","image",1,"admin-article__image",3,"isPhoto","isClickable"],[1,"admin-article__main"],["formControlName","title","placeholder","Enter post label",1,"admin-article__input",3,"label"],["formControlName","author","placeholder","Enter post author",1,"admin-article__input",3,"label"],[1,"admin-article__categories"],[1,"admin-article__category"],["formControlName","level1Category","placeholder","Select category","bindValue","_id","bindLabel","name",3,"options","theme"],[1,"admin-article__sub-category"],["formControlName","level2Category","placeholder","Select subcategory","bindValue","_id","bindLabel","name",3,"options","theme"],[1,"admin-article__additional"],["formControlName","country","placeholder","Select Country",1,"admin-article__country",3,"theme"],[1,"admin-article__tags"],["formControlName","tags",3,"searchedOptions","searched"],["type","text","b2bNgxInput","","formControlName","shortDescription","placeholder","Enter short description of this article (up to 140 symbols)",3,"theme"],["formControlName","description",1,"admin-article__description",3,"config"],["class","image-alts",4,"ngIf"],["class","image-alts__tooltip",4,"ngIf"],["b2bNgxButton","",1,"admin-article__button",3,"theme"],[1,"image-alts"],[1,"image-alts__input"],["type","text","b2bNgxInput","","placeholder","Enter alt for picture 1","label","Alt for picture 1","formControlName","alt1",3,"theme"],["type","text","b2bNgxInput","","placeholder","Enter alt for picture 2","label","Alt for picture 2","formControlName","alt2",3,"theme"],["type","text","b2bNgxInput","","placeholder","Enter alt for picture 3","label","Alt for picture 3","formControlName","alt3",3,"theme"],["type","text","b2bNgxInput","","placeholder","Enter alt for picture 4","label","Alt for picture 4","formControlName","alt4",3,"theme"],[1,"image-alts__tooltip"]],template:function(i,e){1&i&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return e.onSubmit(e.formGroup.value)}),t.TgZ(1,"p",1),t._uU(2),t.qZA(),t.TgZ(3,"b2b-ngx-file",2),t._uU(4," Image "),t.qZA(),t.TgZ(5,"div",3),t._UZ(6,"b2b-ngx-input",4),t.ALo(7,"translate"),t._UZ(8,"b2b-ngx-input",5),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"div",6)(11,"div",7),t._UZ(12,"b2b-ngx-select",8),t.qZA(),t.TgZ(13,"div",9),t._UZ(14,"b2b-ngx-select",10),t.qZA()(),t.TgZ(15,"div",11),t._UZ(16,"b2b-ngx-country-select",12),t.TgZ(17,"div",13)(18,"b2b-ngx-chips",14),t.NdJ("searched",function(r){return e.setSearch(r)}),t.ALo(19,"async"),t.qZA()()(),t.TgZ(20,"div",3),t._UZ(21,"input",15),t.qZA(),t._UZ(22,"angular-editor",16),t.YNc(23,ot,9,4,"div",17),t.YNc(24,at,2,0,"div",18),t.TgZ(25,"button",19),t._uU(26),t.qZA()()),2&i&&(t.Q6J("formGroup",e.formGroup),t.xp6(2),t.hij(" ",e.blogAction===e.blogActionEnum.EDIT?"Edit an post":"Add an post"," "),t.xp6(1),t.Q6J("isPhoto",!0)("isClickable",!0),t.xp6(3),t.Q6J("label",t.lcZ(7,18,"LABELS.ARTICLE_LABEL")),t.xp6(2),t.Q6J("label",t.lcZ(9,20,"LABELS.ARTICLE_AUTHOR")),t.xp6(4),t.Q6J("options",e.level1Categories)("theme",e.b2bNgxSelectThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("options",e.level2Categories)("theme",e.b2bNgxSelectThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("theme",e.b2bNgxSelectThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("searchedOptions",t.lcZ(19,22,e.searchedOptions$)),t.xp6(3),t.Q6J("theme",e.b2bNgxInputThemeEnum.BACKGROUND_GRAY),t.xp6(1),t.Q6J("config",e.editorConfig),t.xp6(1),t.Q6J("ngIf",e.blogAction===e.blogActionEnum.EDIT),t.xp6(1),t.Q6J("ngIf",e.blogAction===e.blogActionEnum.CREATE),t.xp6(1),t.Q6J("theme",e.b2bNgxButtonThemeEnum.BACKGROUND_BLACK),t.xp6(1),t.hij(" ",e.formGroup.get("_id").value?"Update an post":"Create an post"," "))},dependencies:[A.O5,w.F,k.k,q.d,tt.B,et.f,nt.V,E.s6,g._Y,g.Fj,g.JJ,g.JL,g.sg,g.u,it.L,A.Ov,Z.X$],styles:[".admin-article[_ngcontent-%COMP%]{display:block;margin:30px;background-color:#fff;padding:60px}.admin-article[_ngcontent-%COMP%]   .image-alts__input[_ngcontent-%COMP%]{margin-top:20px}.admin-article[_ngcontent-%COMP%]   .image-alts__tooltip[_ngcontent-%COMP%]{color:#6c7077}.admin-article[_ngcontent-%COMP%]   .admin-article__image[_ngcontent-%COMP%]{display:block;margin-top:30px}.admin-article[_ngcontent-%COMP%]   .admin-article__label[_ngcontent-%COMP%]{font-weight:700;font-size:32px;color:#0f0f11}.admin-article[_ngcontent-%COMP%]   .admin-article__input[_ngcontent-%COMP%]{display:block;margin-top:30px}.admin-article[_ngcontent-%COMP%]   .admin-article__main[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.admin-article[_ngcontent-%COMP%]   .admin-article__main[_ngcontent-%COMP%]   .admin-article__input[_ngcontent-%COMP%]{width:49%}.admin-article[_ngcontent-%COMP%]   .admin-article__additional[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:30px}.admin-article[_ngcontent-%COMP%]   .admin-article__additional[_ngcontent-%COMP%]   .admin-article__country[_ngcontent-%COMP%], .admin-article[_ngcontent-%COMP%]   .admin-article__additional[_ngcontent-%COMP%]   .admin-article__tags[_ngcontent-%COMP%]{width:49%}.admin-article[_ngcontent-%COMP%]   .admin-article__categories[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:30px}.admin-article[_ngcontent-%COMP%]   .admin-article__categories[_ngcontent-%COMP%]   .admin-article__category[_ngcontent-%COMP%], .admin-article[_ngcontent-%COMP%]   .admin-article__categories[_ngcontent-%COMP%]   .admin-article__sub-category[_ngcontent-%COMP%]{width:49%}.admin-article[_ngcontent-%COMP%]   .admin-article__button[_ngcontent-%COMP%]{margin-top:30px;padding:15px 40px}  .angular-editor-textarea img{max-width:100%}  .angular-editor-textarea p{line-height:24px}  .ngx-files-list-item{margin-top:0!important}  .admin-article__description{display:block;margin-top:30px;overflow:hidden;line-height:24px}  .admin-article__description span,   .admin-article__description p{line-height:24px}  .admin-article__description ul,   .admin-article__description li{list-style:disc!important}  .admin-article__description ul{padding-left:30px}  .admin-article__description strong,   .admin-article__description b{font-weight:700!important}  .admin-article__description img{width:100%}"],changeDetection:0}),p=(0,G.gn)([(0,f.c)()],p);const rt=[{path:"",component:p}];let st=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[h.Bz.forChild(rt),h.Bz]}),o})(),ct=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[A.ez,st,S.r,R.y,U.F,B.l,I.N,E.UM,g.UX,_.v,Z.aw]}),o})()}}]);