"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3088],{23698:(y,l,s)=>{s.r(l),s.d(l,{AdminSourcingRequestModule:()=>se});var a=s(96814),d=s(44112),h=s(49671),p=s(97582),u=s(48530),A=s(77835),v=s(78645),m=s(52572),g=s(32181),R=s(9769),$=s(24036),I=s(81374),P=s(27921),x=s(94664),E=s(37398),c=s(78791),j=s(26453),N=s(55422),F=s(20553),Q=s(94045),M=function(n){return n.SOURCING_REQUEST="SOURCING_REQUEST",n.UNCLAIMED_CARGO="UNCLAIMED_CARGO",n.MARKET="MARKET",n}(M||{}),D=s(67028),r=s(19212),b=s(99397),B=s(87588),K=s(16113),G=s(75972),L=s(58133);function S(n){return n.photos&&n.photos.length?n.photos[0].lg:null}let Y=(()=>{let n=class C{constructor(e,t,i,o){this._apiService=e,this._offersQuery=t,this._offersStore=i,this._hotToastService=o,this._endpoint="offers/"}removeAllOffers(){return this._apiService.delete("offers/delete")}getContainerLocation(e){return this._apiService.get(`container/location?${e}`)}getAllOffersCount(){return this._offersQuery.selectAllOffersCount$}getSeaLines(){const{seaLines:e}=this._offersQuery.getValue();return e.length||this._apiService.get("seaLines").pipe((0,c.t)(this)).subscribe(t=>{this._offersStore.update({seaLines:t})}),this._offersQuery.selectSeaLines$}markAsSold(e){this._apiService.post(`offer/${e}/status/update`,{status:"sold"}).pipe((0,c.t)(this),this._hotToastService.observe({loading:"Offer status updating...",success:"Offer status updated successfully!",error:"Offer status updating failed!"})).subscribe()}deleteOfferSub(e){return this._apiService.delete(`offer/${e}/delete`).pipe((0,c.t)(this))}deleteOfferById(e,t){return this._apiService.delete(`offer/${e}/delete`,t)}getOfferById(e){return this._apiService.get(`offer/${e}/`).pipe((0,b.b)(t=>{this._offersStore.update({offer:t})}))}getMyOffers(){return this._apiService.get("my/offers/").pipe((0,c.t)(this)).subscribe(e=>{this._offersStore.update({myOffers:e.map(t=>({...t,previewPhoto:S(t)}))})}),this._offersQuery.selectMyOffers$}getOffers(e=""){return this._apiService.get("tradeBid/get-rfq-admin"+e+"&hideCompleted=true").pipe((0,c.t)(this),(0,E.U)(t=>{const{rfqList:i,totalCount:o}=t,f=i.map(O=>({...O,previewPhoto:S(O)}));return this._offersStore.update({allOffers:f,allOffersCount:o}),[...f]}))}getActiveOffers(){return this._apiService.get("offers?hideSold=true").pipe((0,c.t)(this),(0,E.U)(e=>{const{offers:t,totalCount:i}=e,o=t.map(f=>({...f,previewPhoto:S(f)}));return this._offersStore.update({allOffers:o,allOffersCount:i}),[...o]}))}getSavedOffers(){return this._apiService.get("my/offers/favourites").subscribe(t=>{this._offersStore.update({savedOffers:t.map(i=>({...i,previewPhoto:S(i)}))})}),this._offersQuery.selectSavedOffers$}createOffer(e){return this._apiService.post("offer/create",e)}updateOffer(e,t){return this._apiService.put(`offer/${t}/update`,e)}addFavoriteOffer(e){return this._apiService.post(`user/favourites/${e}/add`,{}).pipe((0,b.b)(()=>{this._offersStore.update({allOffers:this._offersStore.getValue().allOffers.map(t=>({...t,isSaved:t._id===e||t.isSaved}))})}))}removeFavoriteOffer(e){return this._apiService.delete(`user/favourites/${e}/remove`).pipe((0,b.b)(()=>{const{savedOffers:t,allOffers:i}=this._offersQuery.getValue();this._offersStore.update({savedOffers:t.filter(o=>o._id!==e),allOffers:i.map(o=>({...o,isSaved:o._id!==e&&o.isSaved}))})}))}approveOffer(e){return this._apiService.post("tradeBid/rfq-approval",{id:e})}declineOffer(e,t){return this._apiService.post("tradebid/rfq-rejection",{id:e,reasonForReject:t})}static#e=this.\u0275fac=function(t){return new(t||C)(r.LFG(B.s),r.LFG(K.Y),r.LFG(G.m),r.LFG(L.jE))};static#t=this.\u0275prov=r.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"})};return n=(0,p.gn)([(0,c.c)()],n),n})();var z=s(44901),Z=s(17706),U=s(19347),W=s(69019),J=s(96849),V=s(79645);const w=[{path:"",component:(()=>{let n=class T{constructor(e,t,i,o,f,O,ie){this.adminSourcingRequestService=e,this._offersService=t,this._hotToastrService=i,this._apiService=o,this._usersService=f,this.dialog=O,this.mixpanelService=ie,this.listType=M,this.pageSubject=new v.x,this.forceSubject=new v.x,this.b2bNgxButtonThemeEnum=u.n,this.b2bNgxLinkThemeEnum=A.L,this.offers$=this._getOffers$(),this.menuOptions=this._getMenuOptions(),this.totalCount$=this._offersService.getAllOffersCount(),this._usersService.getToken$().pipe((0,I.P)()).subscribe(re=>{this.token=re,this.openConnection()})}ngOnInit(){}export(){this._apiService.get("get-user-report").pipe((0,c.t)(this)).subscribe()}removeAllOffers(){this._offersService.removeAllOffers().pipe((0,c.t)(this),this._hotToastrService.observe({loading:"Offers is deleting...",success:"Offers successfully deleted",error:"Offers deleting failed"})).subscribe()}_getOffers$(){const e=this.pageSubject.asObservable().pipe((0,P.O)(1)),t=this.forceSubject.asObservable().pipe((0,P.O)(!0));return(0,m.a)([e,t]).pipe((0,x.w)(([i])=>this.adminSourcingRequestService.getOffers("?offset="+10*(i-1))),(0,E.U)(i=>i))}setPage(e){this.pageSubject.next(e)}_getMenuOptions(){var e=this;return[{label:"Delete",icon:"delete-red",onClick:t=>{this.dialog.open(Q.z,{data:{title:"Delete product",message:"Are you sure you want to delete this product?",confirmButtonText:"Delete",confirmButtonTheme:u.n.BACKGROUND_RED,cancelButtonText:"Cancel",cancelButtonTheme:u.n.OUTLINE_BLACK}}).afterClosed().pipe((0,g.h)(i=>!!i),(0,R.z)(()=>this._offersService.deleteRfq(t._id).pipe((0,c.t)(this),this._hotToastrService.observe({loading:"Offer deleting",success:"Offer deleted",error:"Offer deleting failed"})))).subscribe(()=>{this.forceSubject.next(!0)})}},{label:"approve by admin",icon:"check",onClick:t=>{this.adminSourcingRequestService.approveOffer(t._id).pipe((0,c.t)(this)).subscribe(()=>{this.forceSubject.next(!0),this._hotToastrService.success("approved"),this.mixpanelService.track("New RFQ approved",{distinctId:t.user,"Product Sector":t.category[0].name,Destination:(0,D.oY)(t.destination.to),"Approving Date":Date()})})}},{label:"decline by admin",icon:"cross",onClick:t=>{this.startChat(t.user,t._id),this.dialog.open(j.S,{data:{chatUsers:t.chatStarted},width:"40vw",height:"auto",minHeight:"0"}).afterClosed().pipe((0,c.t)(this)).subscribe(function(){var i=(0,h.Z)(function*(o){o&&(yield e.openConnection(),e.adminSourcingRequestService.declineOffer(t._id,o).pipe((0,c.t)(e)).subscribe((0,h.Z)(function*(){e.sendMessage(t.user,t._id,o),e.closeConnection(),e.forceSubject.next(!0),e._hotToastrService.success("declined"),yield e.trackDecline(t)})))});return function(o){return i.apply(this,arguments)}}())}}]}trackDecline(e){var t=this;setTimeout((0,h.Z)(function*(){const i=yield(0,$.z)(t._usersService.getUserById(e.user));t.mixpanelService.track("Product declined",{"Product Category":e?.category?.name,"Supplier's Country":(0,D.oY)(e?.destination?.to),"Product Count":i?.statistics?.products?.approved??e?.amount?.count,"Deletion Date":new Date})}),1e3)}openConnection(){this._socket=(0,N.io)(F.N.apiUrl,{path:"/chat",auth:{token:this.token}})}startChat(e,t){this._socket.emit("start_chat",{userId:e,offerId:t})}sendMessage(e,t,i){i&&this._socket.emit("message",{type:"text",body:i,userId:e,offerId:t})}closeConnection(){this._socket&&this._socket.disconnect()}static#e=this.\u0275fac=function(t){return new(t||T)(r.Y36(Y),r.Y36(z.b),r.Y36(L.jE),r.Y36(B.s),r.Y36(Z.K),r.Y36(U.uw),r.Y36(W.h))};static#t=this.\u0275cmp=r.Xpm({type:T,selectors:[["b2b-admin-sourcing-request"]],decls:5,vars:9,consts:[[1,"admin-offers"],[3,"offers","menuOptions","listType"],[3,"length","perPage","togglePageNumber"]],template:function(t,i){1&t&&(r.TgZ(0,"div",0),r._UZ(1,"app-admin-offers-list",1),r.ALo(2,"async"),r.TgZ(3,"b2b-pagination",2),r.NdJ("togglePageNumber",function(f){return i.setPage(f)}),r.ALo(4,"async"),r.qZA()()),2&t&&(r.xp6(),r.Q6J("offers",r.lcZ(2,5,i.offers$))("menuOptions",i.menuOptions)("listType",i.listType.SOURCING_REQUEST),r.xp6(2),r.Q6J("length",r.lcZ(4,7,i.totalCount$))("perPage",10))},dependencies:[J.N,V.Q,a.Ov],styles:[".admin-offers[_ngcontent-%COMP%]{padding:20px}"]})};return n=(0,p.gn)([(0,c.c)()],n),n})()},{path:":id",component:s(50037).O}];let k=(()=>{class n{static#e=this.\u0275fac=function(t){return new(t||n)};static#t=this.\u0275mod=r.oAB({type:n});static#s=this.\u0275inj=r.cJS({imports:[d.Bz.forChild(w),d.Bz]})}return n})();var q=s(65033),_=s(89611),ee=s(62993),te=s(75870);let se=(()=>{class n{static#e=this.\u0275fac=function(t){return new(t||n)};static#t=this.\u0275mod=r.oAB({type:n});static#s=this.\u0275inj=r.cJS({imports:[a.ez,k,q.l,_.z,ee.v,U.Is,te.u]})}return n})()},32336:(y,l,s)=>{s.d(l,{A:()=>d});var a=s(86825);const d=(0,a.X$)("fadeInOut",[(0,a.eR)(":enter",[(0,a.oB)({opacity:0}),(0,a.jt)(500,(0,a.oB)({opacity:1}))]),(0,a.eR)(":leave",[(0,a.jt)(500,(0,a.oB)({opacity:0}))])])},75870:(y,l,s)=>{s.d(l,{u:()=>p});var a=s(96814),d=s(98653),h=s(19212);let p=(()=>{class u{static#e=this.\u0275fac=function(m){return new(m||u)};static#t=this.\u0275mod=h.oAB({type:u});static#s=this.\u0275inj=h.cJS({imports:[a.ez,d.w]})}return u})()},24036:(y,l,s)=>{s.d(l,{z:()=>h});var a=s(46973),d=s(80305);function h(p,u){const A="object"==typeof u;return new Promise((v,m)=>{const g=new d.Hp({next:R=>{v(R),g.unsubscribe()},error:m,complete:()=>{A?v(u.defaultValue):m(new a.K)}});p.subscribe(g)})}}}]);