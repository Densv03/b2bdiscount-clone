"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7014],{73463:(y,l,s)=>{s.r(l),s.d(l,{AdminSourcingRequestModule:()=>se});var a=s(60177),d=s(52168),h=s(10467),p=s(85623),u=s(51809),R=s(2628),v=s(21413),m=s(84572),g=s(5964),M=s(73028),B=s(54843),j=s(61594),E=s(99172),x=s(25558),A=s(96354),c=s(49894),G=s(6675),L=s(19774),F=s(45312),K=s(28659),P=function(n){return n.SOURCING_REQUEST="SOURCING_REQUEST",n.UNCLAIMED_CARGO="UNCLAIMED_CARGO",n.MARKET="MARKET",n}(P||{}),D=s(65892),r=s(54438),T=s(88141),U=s(40735),N=s(17691),Q=s(21638),$=s(72558);function S(n){return n.photos&&n.photos.length?n.photos[0].lg:null}let V=(()=>{let n=class C{constructor(e,t,i,o){this._apiService=e,this._offersQuery=t,this._offersStore=i,this._hotToastService=o,this._endpoint="offers/"}removeAllOffers(){return this._apiService.delete("offers/delete")}getContainerLocation(e){return this._apiService.get(`container/location?${e}`)}getAllOffersCount(){return this._offersQuery.selectAllOffersCount$}getSeaLines(){const{seaLines:e}=this._offersQuery.getValue();return e.length||this._apiService.get("seaLines").pipe((0,c.s)(this)).subscribe(t=>{this._offersStore.update({seaLines:t})}),this._offersQuery.selectSeaLines$}markAsSold(e){this._apiService.post(`offer/${e}/status/update`,{status:"sold"}).pipe((0,c.s)(this),this._hotToastService.observe({loading:"Offer status updating...",success:"Offer status updated successfully!",error:"Offer status updating failed!"})).subscribe()}deleteOfferSub(e){return this._apiService.delete(`offer/${e}/delete`).pipe((0,c.s)(this))}deleteOfferById(e,t){return this._apiService.delete(`offer/${e}/delete`,t)}getOfferById(e){return this._apiService.get(`offer/${e}/`).pipe((0,T.M)(t=>{this._offersStore.update({offer:t})}))}getMyOffers(){return this._apiService.get("my/offers/").pipe((0,c.s)(this)).subscribe(e=>{this._offersStore.update({myOffers:e.map(t=>({...t,previewPhoto:S(t)}))})}),this._offersQuery.selectMyOffers$}getOffers(e=""){return this._apiService.get("tradeBid/get-rfq-admin"+e+"&hideCompleted=true").pipe((0,c.s)(this),(0,A.T)(t=>{const{rfqList:i,totalCount:o}=t,f=i.map(O=>({...O,previewPhoto:S(O)}));return this._offersStore.update({allOffers:f,allOffersCount:o}),[...f]}))}getActiveOffers(){return this._apiService.get("offers?hideSold=true").pipe((0,c.s)(this),(0,A.T)(e=>{const{offers:t,totalCount:i}=e,o=t.map(f=>({...f,previewPhoto:S(f)}));return this._offersStore.update({allOffers:o,allOffersCount:i}),[...o]}))}getSavedOffers(){return this._apiService.get("my/offers/favourites").subscribe(t=>{this._offersStore.update({savedOffers:t.map(i=>({...i,previewPhoto:S(i)}))})}),this._offersQuery.selectSavedOffers$}createOffer(e){return this._apiService.post("offer/create",e)}updateOffer(e,t){return this._apiService.put(`offer/${t}/update`,e)}addFavoriteOffer(e){return this._apiService.post(`user/favourites/${e}/add`,{}).pipe((0,T.M)(()=>{this._offersStore.update({allOffers:this._offersStore.getValue().allOffers.map(t=>({...t,isSaved:t._id===e||t.isSaved}))})}))}removeFavoriteOffer(e){return this._apiService.delete(`user/favourites/${e}/remove`).pipe((0,T.M)(()=>{const{savedOffers:t,allOffers:i}=this._offersQuery.getValue();this._offersStore.update({savedOffers:t.filter(o=>o._id!==e),allOffers:i.map(o=>({...o,isSaved:o._id!==e&&o.isSaved}))})}))}approveOffer(e){return this._apiService.post("tradeBid/rfq-approval",{id:e})}declineOffer(e,t){return this._apiService.post("tradebid/rfq-rejection",{id:e,reasonForReject:t})}static#e=this.\u0275fac=function(t){return new(t||C)(r.KVO(U.G),r.KVO(N.e),r.KVO(Q.B),r.KVO($.U_))};static#t=this.\u0275prov=r.jDH({token:C,factory:C.\u0275fac,providedIn:"root"})};return n=(0,p.Cg)([(0,c.d)()],n),n})();var W=s(4255),X=s(31126),I=s(34006),Z=s(37409),Y=s(35735),H=s(3997);const k=[{path:"",component:(()=>{let n=class b{constructor(e,t,i,o,f,O,ie){this.adminSourcingRequestService=e,this._offersService=t,this._hotToastrService=i,this._apiService=o,this._usersService=f,this.dialog=O,this.mixpanelService=ie,this.listType=P,this.pageSubject=new v.B,this.forceSubject=new v.B,this.b2bNgxButtonThemeEnum=u.a,this.b2bNgxLinkThemeEnum=R.M,this.offers$=this._getOffers$(),this.menuOptions=this._getMenuOptions(),this.totalCount$=this._offersService.getAllOffersCount(),this._usersService.getToken$().pipe((0,j.$)()).subscribe(re=>{this.token=re,this.openConnection()})}ngOnInit(){}export(){this._apiService.get("get-user-report").pipe((0,c.s)(this)).subscribe()}removeAllOffers(){this._offersService.removeAllOffers().pipe((0,c.s)(this),this._hotToastrService.observe({loading:"Offers is deleting...",success:"Offers successfully deleted",error:"Offers deleting failed"})).subscribe()}_getOffers$(){const e=this.pageSubject.asObservable().pipe((0,E.Z)(1)),t=this.forceSubject.asObservable().pipe((0,E.Z)(!0));return(0,m.z)([e,t]).pipe((0,x.n)(([i])=>this.adminSourcingRequestService.getOffers("?offset="+10*(i-1))),(0,A.T)(i=>i))}setPage(e){this.pageSubject.next(e)}_getMenuOptions(){var e=this;return[{label:"Delete",icon:"delete-red",onClick:t=>{this.dialog.open(K.D,{data:{title:"Delete product",message:"Are you sure you want to delete this product?",confirmButtonText:"Delete",confirmButtonTheme:u.a.BACKGROUND_RED,cancelButtonText:"Cancel",cancelButtonTheme:u.a.OUTLINE_BLACK}}).afterClosed().pipe((0,g.p)(i=>!!i),(0,M.Z)(()=>this._offersService.deleteRfq(t._id).pipe((0,c.s)(this),this._hotToastrService.observe({loading:"Offer deleting",success:"Offer deleted",error:"Offer deleting failed"})))).subscribe(()=>{this.forceSubject.next(!0)})}},{label:"approve by admin",icon:"check",onClick:t=>{this.adminSourcingRequestService.approveOffer(t._id).pipe((0,c.s)(this)).subscribe(()=>{this.forceSubject.next(!0),this._hotToastrService.success("approved"),this.mixpanelService.track("New RFQ approved",{distinctId:t.user,"Product Sector":t.category[0].name,Destination:(0,D.mG)(t.destination.to),"Approving Date":Date()})})}},{label:"decline by admin",icon:"cross",onClick:t=>{this.startChat(t.user,t._id),this.dialog.open(G.t,{data:{chatUsers:t.chatStarted},width:"40vw",height:"auto",minHeight:"0"}).afterClosed().pipe((0,c.s)(this)).subscribe(function(){var i=(0,h.A)(function*(o){o&&(yield e.openConnection(),e.adminSourcingRequestService.declineOffer(t._id,o).pipe((0,c.s)(e)).subscribe((0,h.A)(function*(){e.sendMessage(t.user,t._id,o),e.closeConnection(),e.forceSubject.next(!0),e._hotToastrService.success("declined"),yield e.trackDecline(t)})))});return function(o){return i.apply(this,arguments)}}())}}]}trackDecline(e){var t=this;setTimeout((0,h.A)(function*(){const i=yield(0,B._)(t._usersService.getUserById(e.user));t.mixpanelService.track("Product declined",{"Product Category":e?.category?.name,"Supplier's Country":(0,D.mG)(e?.destination?.to),"Product Count":i?.statistics?.products?.approved??e?.amount?.count,"Deletion Date":new Date})}),1e3)}openConnection(){this._socket=(0,L.io)(F.c.apiUrl,{path:"/chat",auth:{token:this.token}})}startChat(e,t){this._socket.emit("start_chat",{userId:e,offerId:t})}sendMessage(e,t,i){i&&this._socket.emit("message",{type:"text",body:i,userId:e,offerId:t})}closeConnection(){this._socket&&this._socket.disconnect()}static#e=this.\u0275fac=function(t){return new(t||b)(r.rXU(V),r.rXU(W.F),r.rXU($.U_),r.rXU(U.G),r.rXU(X.D),r.rXU(I.bZ),r.rXU(Z.U))};static#t=this.\u0275cmp=r.VBU({type:b,selectors:[["b2b-admin-sourcing-request"]],decls:5,vars:9,consts:[[1,"admin-offers"],[3,"offers","menuOptions","listType"],[3,"togglePageNumber","length","perPage"]],template:function(t,i){1&t&&(r.j41(0,"div",0),r.nrm(1,"app-admin-offers-list",1),r.nI1(2,"async"),r.j41(3,"b2b-pagination",2),r.nI1(4,"async"),r.bIt("togglePageNumber",function(f){return i.setPage(f)}),r.k0s()()),2&t&&(r.R7$(),r.Y8G("offers",r.bMT(2,5,i.offers$))("menuOptions",i.menuOptions)("listType",i.listType.SOURCING_REQUEST),r.R7$(2),r.Y8G("length",r.bMT(4,7,i.totalCount$))("perPage",10))},dependencies:[Y.s,H.e,a.Jj],styles:[".admin-offers[_ngcontent-%COMP%]{padding:20px}"]})};return n=(0,p.Cg)([(0,c.d)()],n),n})()},{path:":id",component:s(40291).r}];let _=(()=>{class n{static#e=this.\u0275fac=function(t){return new(t||n)};static#t=this.\u0275mod=r.$C({type:n});static#s=this.\u0275inj=r.G2t({imports:[d.iI.forChild(k),d.iI]})}return n})();var q=s(81529),w=s(69388),ee=s(81931),te=s(18560);let se=(()=>{class n{static#e=this.\u0275fac=function(t){return new(t||n)};static#t=this.\u0275mod=r.$C({type:n});static#s=this.\u0275inj=r.G2t({imports:[a.MD,_,q.P,w.O,ee.M,I.hM,te.x]})}return n})()},86368:(y,l,s)=>{s.d(l,{S:()=>d});var a=s(49969);const d=(0,a.hZ)("fadeInOut",[(0,a.kY)(":enter",[(0,a.iF)({opacity:0}),(0,a.i0)(500,(0,a.iF)({opacity:1}))]),(0,a.kY)(":leave",[(0,a.i0)(500,(0,a.iF)({opacity:0}))])])},18560:(y,l,s)=>{s.d(l,{x:()=>p});var a=s(60177),d=s(24318),h=s(54438);let p=(()=>{class u{static#e=this.\u0275fac=function(m){return new(m||u)};static#t=this.\u0275mod=h.$C({type:u});static#s=this.\u0275inj=h.G2t({imports:[a.MD,d.F]})}return u})()},54843:(y,l,s)=>{s.d(l,{_:()=>h});var a=s(9350),d=s(47707);function h(p,u){const R="object"==typeof u;return new Promise((v,m)=>{const g=new d.Ms({next:M=>{v(M),g.unsubscribe()},error:m,complete:()=>{R?v(u.defaultValue):m(new a.G)}});p.subscribe(g)})}}}]);