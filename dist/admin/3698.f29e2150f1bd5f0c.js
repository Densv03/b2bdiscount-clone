"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3698],{23698:($,u,s)=>{s.r(u),s.d(u,{AdminSourcingRequestModule:()=>te});var l=s(96814),d=s(44112),h=s(49671),p=s(97582),f=s(48530),L=s(77835),S=s(78645),O=s(52572),x=s(32181),B=s(9769),D=s(81374),R=s(27921),U=s(94664),C=s(37398),a=s(51791),j=s(26453),N=s(55887),I=s(20553),Q=s(94045),T=function(o){return o.SOURCING_REQUEST="SOURCING_REQUEST",o.UNCLAIMED_CARGO="UNCLAIMED_CARGO",o.MARKET="MARKET",o}(T||{}),b=s(67028),i=s(65879),y=s(99397),P=s(87588),F=s(16113),G=s(75972),E=s(58133);function v(o){return o.photos&&o.photos.length?o.photos[0].lg:null}let Y=(()=>{let o=class m{constructor(t,e,r,n){this._apiService=t,this._offersQuery=e,this._offersStore=r,this._hotToastService=n,this._endpoint="offers/"}removeAllOffers(){return this._apiService.delete("offers/delete")}getContainerLocation(t){return this._apiService.get(`container/location?${t}`)}getAllOffersCount(){return this._offersQuery.selectAllOffersCount$}getSeaLines(){const{seaLines:t}=this._offersQuery.getValue();return t.length||this._apiService.get("seaLines").pipe((0,a.t)(this)).subscribe(e=>{this._offersStore.update({seaLines:e})}),this._offersQuery.selectSeaLines$}markAsSold(t){this._apiService.post(`offer/${t}/status/update`,{status:"sold"}).pipe((0,a.t)(this),this._hotToastService.observe({loading:"Offer status updating...",success:"Offer status updated successfully!",error:"Offer status updating failed!"})).subscribe()}deleteOfferSub(t){return this._apiService.delete(`offer/${t}/delete`).pipe((0,a.t)(this))}deleteOfferById(t,e){return this._apiService.delete(`offer/${t}/delete`,e)}getOfferById(t){return this._apiService.get(`offer/${t}/`).pipe((0,y.b)(e=>{this._offersStore.update({offer:e})}))}getMyOffers(){return this._apiService.get("my/offers/").pipe((0,a.t)(this)).subscribe(t=>{this._offersStore.update({myOffers:t.map(e=>({...e,previewPhoto:v(e)}))})}),this._offersQuery.selectMyOffers$}getOffers(t=""){return this._apiService.get("tradeBid/get-rfq-admin"+t+"&hideCompleted=true").pipe((0,a.t)(this),(0,C.U)(e=>{const{rfqList:r,totalCount:n}=e,c=r.map(g=>({...g,previewPhoto:v(g)}));return this._offersStore.update({allOffers:c,allOffersCount:n}),[...c]}))}getActiveOffers(){return this._apiService.get("offers?hideSold=true").pipe((0,a.t)(this),(0,C.U)(t=>{const{offers:e,totalCount:r}=t,n=e.map(c=>({...c,previewPhoto:v(c)}));return this._offersStore.update({allOffers:n,allOffersCount:r}),[...n]}))}getSavedOffers(){return this._apiService.get("my/offers/favourites").subscribe(e=>{this._offersStore.update({savedOffers:e.map(r=>({...r,previewPhoto:v(r)}))})}),this._offersQuery.selectSavedOffers$}createOffer(t){return this._apiService.post("offer/create",t)}updateOffer(t,e){return this._apiService.put(`offer/${e}/update`,t)}addFavoriteOffer(t){return this._apiService.post(`user/favourites/${t}/add`,{}).pipe((0,y.b)(()=>{this._offersStore.update({allOffers:this._offersStore.getValue().allOffers.map(e=>({...e,isSaved:e._id===t||e.isSaved}))})}))}removeFavoriteOffer(t){return this._apiService.delete(`user/favourites/${t}/remove`).pipe((0,y.b)(()=>{const{savedOffers:e,allOffers:r}=this._offersQuery.getValue();this._offersStore.update({savedOffers:e.filter(n=>n._id!==t),allOffers:r.map(n=>({...n,isSaved:n._id!==t&&n.isSaved}))})}))}approveOffer(t){return this._apiService.post("tradeBid/rfq-approval",{id:t})}declineOffer(t,e){return this._apiService.post("tradebid/rfq-rejection",{id:t,reasonForReject:e})}static#e=this.\u0275fac=function(e){return new(e||m)(i.LFG(P.s),i.LFG(F.Y),i.LFG(G.m),i.LFG(E.jE))};static#t=this.\u0275prov=i.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})};return o=(0,p.gn)([(0,a.c)()],o),o})();var z=s(44901),K=s(17706),M=s(19347),Z=s(69019),J=s(96849),W=s(79645);const X=[{path:"",component:(()=>{let o=class A{constructor(t,e,r,n,c,g,se){this.adminSourcingRequestService=t,this._offersService=e,this._hotToastrService=r,this._apiService=n,this._usersService=c,this.dialog=g,this.mixpanelService=se,this.listType=T,this.pageSubject=new S.x,this.forceSubject=new S.x,this.b2bNgxButtonThemeEnum=f.n,this.b2bNgxLinkThemeEnum=L.L,this.offers$=this._getOffers$(),this.menuOptions=this._getMenuOptions(),this.totalCount$=this._offersService.getAllOffersCount(),this._usersService.getToken$().pipe((0,D.P)()).subscribe(ie=>{this.token=ie,this.openConnection()})}ngOnInit(){}export(){this._apiService.get("get-user-report").pipe((0,a.t)(this)).subscribe()}removeAllOffers(){this._offersService.removeAllOffers().pipe((0,a.t)(this),this._hotToastrService.observe({loading:"Offers is deleting...",success:"Offers successfully deleted",error:"Offers deleting failed"})).subscribe()}_getOffers$(){const t=this.pageSubject.asObservable().pipe((0,R.O)(1)),e=this.forceSubject.asObservable().pipe((0,R.O)(!0));return(0,O.a)([t,e]).pipe((0,U.w)(([r])=>this.adminSourcingRequestService.getOffers("?offset="+10*(r-1))),(0,C.U)(r=>r))}setPage(t){this.pageSubject.next(t)}_getMenuOptions(){var t=this;return[{label:"Delete",icon:"delete-red",onClick:e=>{this.dialog.open(Q.z,{data:{title:"Delete product",message:"Are you sure you want to delete this product?",confirmButtonText:"Delete",confirmButtonTheme:f.n.BACKGROUND_RED,cancelButtonText:"Cancel",cancelButtonTheme:f.n.OUTLINE_BLACK}}).afterClosed().pipe((0,x.h)(r=>!!r),(0,B.z)(()=>this._offersService.deleteRfq(e._id).pipe((0,a.t)(this),this._hotToastrService.observe({loading:"Offer deleting",success:"Offer deleted",error:"Offer deleting failed"})))).subscribe(()=>{this.forceSubject.next(!0)})}},{label:"approve by admin",icon:"check",onClick:e=>{this.adminSourcingRequestService.approveOffer(e._id).pipe((0,a.t)(this)).subscribe(()=>{this.forceSubject.next(!0),this._hotToastrService.success("approved"),this.mixpanelService.track("New RFQ approved",{"Product Sector":e.category[0].name,Destination:(0,b.oY)(e.destination.to),"Approving Date":Date()})})}},{label:"decline by admin",icon:"cross",onClick:e=>{this.startChat(e.user,e._id),this.dialog.open(j.S,{data:{chatUsers:e.chatStarted},width:"40vw",height:"auto",minHeight:"0"}).afterClosed().pipe((0,a.t)(this)).subscribe(function(){var r=(0,h.Z)(function*(n){n&&(yield t.openConnection(),t.adminSourcingRequestService.declineOffer(e._id,n).pipe((0,a.t)(t)).subscribe(()=>{t.sendMessage(e.user,e._id,n),t.closeConnection(),t.forceSubject.next(!0),t._hotToastrService.success("declined"),t.mixpanelService.track("Product declined",{"Product Category":e?.category?.name,"Supplier's Country":(0,b.oY)(e?.destination?.to),"Product Count":e?.amount?.count,"Deletion Date":Date()})}))});return function(n){return r.apply(this,arguments)}}())}}]}openConnection(){this._socket=(0,N.io)(I.N.apiUrl,{path:"/chat",auth:{token:this.token}})}startChat(t,e){this._socket.emit("start_chat",{userId:t,offerId:e})}sendMessage(t,e,r){r&&this._socket.emit("message",{type:"text",body:r,userId:t,offerId:e})}closeConnection(){this._socket&&this._socket.disconnect()}static#e=this.\u0275fac=function(e){return new(e||A)(i.Y36(Y),i.Y36(z.b),i.Y36(E.jE),i.Y36(P.s),i.Y36(K.K),i.Y36(M.uw),i.Y36(Z.h))};static#t=this.\u0275cmp=i.Xpm({type:A,selectors:[["b2b-admin-sourcing-request"]],decls:5,vars:9,consts:[[1,"admin-offers"],[3,"offers","menuOptions","listType"],[3,"length","perPage","togglePageNumber"]],template:function(e,r){1&e&&(i.TgZ(0,"div",0),i._UZ(1,"app-admin-offers-list",1),i.ALo(2,"async"),i.TgZ(3,"b2b-pagination",2),i.NdJ("togglePageNumber",function(c){return r.setPage(c)}),i.ALo(4,"async"),i.qZA()()),2&e&&(i.xp6(1),i.Q6J("offers",i.lcZ(2,5,r.offers$))("menuOptions",r.menuOptions)("listType",r.listType.SOURCING_REQUEST),i.xp6(2),i.Q6J("length",i.lcZ(4,7,r.totalCount$))("perPage",10))},dependencies:[J.N,W.Q,l.Ov],styles:[".admin-offers[_ngcontent-%COMP%]{padding:20px}"]})};return o=(0,p.gn)([(0,a.c)()],o),o})()},{path:":id",component:s(68130).O}];let q=(()=>{class o{static#e=this.\u0275fac=function(e){return new(e||o)};static#t=this.\u0275mod=i.oAB({type:o});static#s=this.\u0275inj=i.cJS({imports:[d.Bz.forChild(X),d.Bz]})}return o})();var k=s(65033),w=s(89611),_=s(62993),ee=s(75870);let te=(()=>{class o{static#e=this.\u0275fac=function(e){return new(e||o)};static#t=this.\u0275mod=i.oAB({type:o});static#s=this.\u0275inj=i.cJS({imports:[l.ez,q,k.l,w.z,_.v,M.Is,ee.u]})}return o})()},75870:($,u,s)=>{s.d(u,{u:()=>p});var l=s(96814),d=s(98653),h=s(65879);let p=(()=>{class f{static#e=this.\u0275fac=function(O){return new(O||f)};static#t=this.\u0275mod=h.oAB({type:f});static#s=this.\u0275inj=h.cJS({imports:[l.ez,d.w]})}return f})()}}]);