"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6673],{76673:(re,F,m)=>{m.r(F),m.d(F,{AdminHomepageModule:()=>q});var S=m(60177),P=m(52168),N=m(85623),H=m(51809),B=m(79601),$=m(96354),U=m(49894),te=m(45312),o=m(54438),w=m(89417),X=m(59052),V=m(72558),Y=m(40735);let I=(()=>{class p{constructor(s){this.apiService=s}getCarouselItems(){return this.apiService.get("cache/first-screen-carousel")}updateCarouselItems(s){return this.apiService.post("product/update-first-screen-carousel",s)}updateSubscription(s){return this.apiService.post("subscription/update-user-subscription",s)}static#e=this.\u0275fac=function(l){return new(l||p)(o.KVO(Y.G))};static#t=this.\u0275prov=o.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})();var K=m(81953),G=m(36529),D=m(29200);function M(p,A){if(1&p){const s=o.RV6();o.j41(0,"p")(1,"input",11),o.bIt("click",function(){const f=o.eBV(s).index,h=o.XpG().index,_=o.XpG(2);return o.Njj(_.onInputClick(h,f))}),o.k0s()()}if(2&p){const s=A.index,l=o.XpG().index,f=o.XpG(2);o.R7$(),o.HbH("url-input-"+l),o.Y8G("theme",f.b2bNgxInputThemeEnum.BACKGROUND_WHITE)("label","Enter url "+f.getLabel(s))}}function L(p,A){if(1&p){const s=o.RV6();o.j41(0,"div")(1,"div",7),o.nrm(2,"b2b-ngx-select",8),o.j41(3,"button",9),o.bIt("click",function(){const f=o.eBV(s).index,h=o.XpG(2);return o.Njj(h.toggleCollapse(f))}),o.EFF(4),o.k0s(),o.j41(5,"button",9),o.bIt("click",function(){const f=o.eBV(s).index,h=o.XpG(2);return o.Njj(h.removeCategory(f))}),o.EFF(6," Remove category "),o.k0s(),o.j41(7,"div",10),o.DNE(8,M,2,4,"p",6),o.k0s()()()}if(2&p){const s=A.$implicit,l=A.index,f=o.XpG().ngIf,h=o.XpG();o.R7$(),o.Y8G("formGroupName",l),o.R7$(),o.Y8G("options",f),o.R7$(),o.Y8G("theme",h.b2bNgxButtonThemeEnum.BACKGROUND_BLUE),o.R7$(),o.SpI(" ",s.value.collapsed?"Expand":"Collapse"," "),o.R7$(),o.Y8G("theme",h.b2bNgxButtonThemeEnum.BACKGROUND_BLUE),o.R7$(2),o.AVh("d-none",!s.value.parentCategory||s.value.collapsed),o.R7$(),o.Y8G("ngForOf",s.value.productIds)}}function k(p,A){if(1&p&&(o.j41(0,"div",5),o.DNE(1,L,9,8,"div",6),o.k0s()),2&p){const s=o.XpG();o.R7$(),o.Y8G("ngForOf",s.categoriesFormArray.controls)}}const J=[{path:"",component:(()=>{let p=class ee{get categoriesFormArray(){return this.form.get("categories")}constructor(s,l,f,h,_){this.fb=s,this.categoriesService=l,this.hotToastService=f,this.elementRef=h,this.homepageService=_,this.b2bNgxButtonThemeEnum=H.a,this.b2bNgxInputThemeEnum=B.Q,this.categories$=this.getCategories$(),this.form=this.fb.group({categories:this.fb.array([this.createNewCategory()])})}ngOnInit(){this.initCarouselCategories()}removeCategory(s){1!==this.categoriesFormArray.length?this.categoriesFormArray.removeAt(s):this.hotToastService.info("You have zero selected categories")}onSave(){const s=[];for(let l=0;l<=6;l++){const f=this.elementRef.nativeElement.querySelectorAll(`.url-input-${l}`),h=this.categoriesFormArray.value[l]?.parentCategory;if(!h)continue;const _=Array.from(f).filter(E=>E.value&&E.value.includes("b2b.discount")).map(E=>{const e=E.value.split("/").pop();return e.includes("?")?e.slice(0,e.lastIndexOf("?")):e});_.length>0&&s.push({id:h,products:_})}this.homepageService.updateCarouselItems(s).pipe((0,U.s)(this),this.hotToastService.observe({loading:"Carousel updating...",success:"Carousel updated successfully",error:"Error while updating carousel"})).subscribe()}addCategory(){this.categoriesFormArray.length>=6?this.hotToastService.info("You can't add more then 6 categories"):this.categoriesFormArray.push(this.createNewCategory())}getLabel(s){if(isNaN(+s))throw"Invalid index";return"string"==typeof s?(parseInt(s)+1).toString():(s+1).toString()}toggleCollapse(s){const l=this.categoriesFormArray.value.map((f,h)=>s===h?{...f,collapsed:!f.collapsed}:f);this.categoriesFormArray.setValue(l)}onInputClick(s,l){if(isNaN(+s)||isNaN(+l))throw new Error("Invalid index");let f;f=document.querySelectorAll(`.url-input-${s}`)[l],f.focus(),f.select()}createNewCategory(){return this.fb.group({parentCategory:[],productIds:[Array(12)],collapsed:!0})}getCategories$(){return this.categoriesService.getCategories$().pipe((0,$.T)(s=>s.categories),(0,$.T)(s=>s.map(({name:l,_id:f})=>({name:l,_id:f}))))}initCarouselCategories(){this.homepageService.getCarouselItems().subscribe(s=>{for(let l=0;l<s.length-1;++l)this.addCategory();this.categoriesFormArray.setValue(s.map(l=>({parentCategory:l._id,productIds:Array(12),collapsed:!0}))),setTimeout(()=>{s.forEach((l,f)=>{document.querySelectorAll(`.url-input-${f}`).forEach((h,_)=>{const E=s[f].products[_]?.path||s[f].products[_]?._id;E&&(h.value=te.c.apiUrl.includes("api-dev")?"dev.b2b.discount/b2bmarket/products/"+E:"b2b.discount/b2bmarket/products/"+E)})})})})}static#e=this.\u0275fac=function(l){return new(l||ee)(o.rXU(w.ok),o.rXU(X.w),o.rXU(V.U_),o.rXU(o.aKT),o.rXU(I))};static#t=this.\u0275cmp=o.VBU({type:ee,selectors:[["b2b-admin-homepage"]],decls:8,vars:6,consts:[[3,"formGroup"],["formArrayName","categories",4,"ngIf"],[1,"d-flex","pt-2"],["b2bNgxButton","",1,"w-50","py-2",3,"click","theme"],["b2bNgxButton","",1,"d-block","w-50","py-2",3,"click","theme"],["formArrayName","categories"],[4,"ngFor","ngForOf"],[1,"d-flex",2,"flex-wrap","wrap",3,"formGroupName"],["placeholder","Select parent category","formControlName","parentCategory","bindValue","_id","bindLabel","name",2,"width","70%",3,"options"],["b2bNgxButton","",2,"width","15%",3,"click","theme"],[1,"w-100"],["type","text","b2bNgxInput","","placeholder","Enter product url ",3,"click","theme","label"]],template:function(l,f){1&l&&(o.j41(0,"form",0),o.DNE(1,k,2,1,"div",1),o.nI1(2,"async"),o.j41(3,"div",2)(4,"button",3),o.bIt("click",function(){return f.addCategory()}),o.EFF(5," Add category "),o.k0s(),o.j41(6,"button",4),o.bIt("click",function(){return f.onSave()}),o.EFF(7," Save changes "),o.k0s()()()),2&l&&(o.Y8G("formGroup",f.form),o.R7$(),o.Y8G("ngIf",o.bMT(2,4,f.categories$)),o.R7$(3),o.Y8G("theme",f.b2bNgxButtonThemeEnum.BACKGROUND_BLUE),o.R7$(2),o.Y8G("theme",f.b2bNgxButtonThemeEnum.BACKGROUND_BLUE))},dependencies:[S.Sq,S.bT,K.Z,G.b,w.qT,w.BC,w.cb,w.j4,w.JD,w.$R,w.v8,D.P,S.Jj]})};return p=(0,N.Cg)([(0,U.d)()],p),p})()}];let W=(()=>{class p{static#e=this.\u0275fac=function(l){return new(l||p)};static#t=this.\u0275mod=o.$C({type:p});static#r=this.\u0275inj=o.G2t({imports:[P.iI.forChild(J),P.iI]})}return p})();var z=m(41820),Q=m(42944),Z=m(99348);let q=(()=>{class p{static#e=this.\u0275fac=function(l){return new(l||p)};static#t=this.\u0275mod=o.$C({type:p});static#r=this.\u0275inj=o.G2t({imports:[S.MD,W,z.i,Q.E,w.X1,Z._]})}return p})()},85623:(re,F,m)=>{function B(e,t,n,r){var c,a=arguments.length,i=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var d=e.length-1;d>=0;d--)(c=e[d])&&(i=(a<3?c(i):a>3?c(t,n,i):c(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i}m.d(F,{Cg:()=>B}),"function"==typeof SuppressedError&&SuppressedError}}]);