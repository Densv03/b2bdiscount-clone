"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3500],{33500:(ut,y,n)=>{n.r(y),n.d(y,{AdminBlogPostModule:()=>rt});var b=n(96814),g=n(56223),M=n(43377),Z=n(38625),B=n(80150),S=n(28514),_=n(82242),I=n(74027),P=n(60420),p=n(44112),R=n(97582),U=n(48530),D=n(87046),h=n(51791),G=n(9315),J=n(52572),L=n(83620),Q=n(93997),Y=n(27921),T=n(94664),E=n(81374),O=n(32181),F=n(37398),j=n(16481),K=n(66027),$=n(20553),t=n(65879),z=n(6255),V=n(58133),W=n(66358),X=n(34624),H=n(17856),w=n(96506),k=n(88657),q=n(83498),tt=n(62033),et=n(61796),N=n(94119);function nt(o,st){if(1&o&&(t.TgZ(0,"div",20)(1,"div",21),t._UZ(2,"input",22),t.qZA(),t.TgZ(3,"div",21),t._UZ(4,"input",23),t.qZA(),t.TgZ(5,"div",21),t._UZ(6,"input",24),t.qZA(),t.TgZ(7,"div",21),t._UZ(8,"input",25),t.qZA()()),2&o){const i=t.oxw();t.xp6(2),t.Q6J("theme",i.b2bNgxInputThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("theme",i.b2bNgxInputThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("theme",i.b2bNgxInputThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("theme",i.b2bNgxInputThemeEnum.BACKGROUND_GRAY)}}function it(o,st){1&o&&(t.TgZ(0,"div",26),t._uU(1," To change alts for picture, edit this post after creation "),t.qZA())}var m=function(o){return o[o.CREATE=0]="CREATE",o[o.EDIT=1]="EDIT",o}(m||{});const ot={editable:!0,spellcheck:!0,height:"auto",minHeight:"200px",translate:"yes",enableToolbar:!0,showToolbar:!0,placeholder:"Enter text here...",fonts:[{class:"arial",name:"Arial"},{class:"times-new-roman",name:"Times New Roman"},{class:"calibri",name:"Calibri"},{class:"comic-sans-ms",name:"Comic Sans MS"}],sanitize:!0,toolbarPosition:"top"},at=[{path:"",component:(()=>{let o=class x{constructor(i,a,e,s,r,l){this.formBuilder=i,this.categoriesService=a,this.hotToastService=e,this.activatedRoute=s,this.blogService=r,this.router=l,this.b2bNgxInputThemeEnum=K.T,this.blogActionEnum=m,this.searchControl=new g.NI,this.b2bNgxSelectThemeEnum=D.B,this.b2bNgxButtonThemeEnum=U.n,this.editorConfig=ot,this.level1Categories=[],this.level2Categories=[],this.searchedOptions$=this.getSearchedOptions()}ngOnInit(){this.blogAction="create"===this.activatedRoute.snapshot.params.id?m.CREATE:m.EDIT,this.getFormGroup(),this.blogAction===m.EDIT&&this.updateArticle(),this.setLevel1Categories(),this.setLevel2Categories()}getSearchedOptions(){return this.searchControl.valueChanges.pipe((0,L.b)(1e3),(0,Q.x)(),(0,Y.O)(""),(0,T.w)(i=>this.blogService.getTags(i)))}setSearch(i){this.searchControl.setValue(i)}onSubmit(i){if(!this.formGroup.valid)return;let{_id:a,level2Category:e,title:s,country:r,description:l,author:C,image:u,shortDescription:ct,alt1:gt,alt2:mt,alt3:dt,alt4:pt}=i;const ht=a?m.EDIT:m.CREATE,d={title:s,description:l,author:C,country:r,category:e,shortDescription:ct};l=l.replaceAll("<a",'<a rel="nofollow"'),l=l.replaceAll("<a",'<a target="_blank""');const f=[gt,mt,dt,pt];let v=0;if(d.description=l.split(""),f[0])for(let c=0;c<l.length-6;++c)"<"===l[c]&&"i"===l[c+1]&&"m"===l[c+2]&&"g"===l[c+3]&&" "===l[c+4]&&"a"===l[c+5]&&f[v]&&(d.description.splice(c,6,`<img alt="${f[v]}"`),v++,c+=3);f.forEach((c,A)=>{c&&(d[`alt${A+1}`]=c)}),d.description=d.description.join(""),ht===m.CREATE?(d.description=l.replace(/<p class="MsoNormal">&#160;<\/p>|<p class="MsoNormal"><b><span>&#160;<\/span><\/b><\/p>/g,"<div><br></div>"),this.blogService.createBlog(d).pipe(this.hotToastService.observe({loading:"Post creating...",success:"Post created successfully!",error:"Post creation failed!"})).subscribe(A=>{this.blogService.uploadImage(this.getFormData({image:u}),A._id).pipe(this.hotToastService.observe({loading:"Uploading images...",success:"Images uploaded successfully!",error:"Images uploading failed!"})).subscribe(()=>this.router.navigate(["/blog"]))})):(0,G.D)([this.blogService.updateBlog(a,d).pipe((0,E.P)()),this.blogService.uploadImage(this.getFormData({image:u}),a).pipe((0,E.P)())]).pipe(this.hotToastService.observe({loading:"Post updating...",success:"Post updated successfully!",error:"Post updating failed!"})).subscribe(()=>this.router.navigate(["/blog"]))}getFormGroup(){this.formGroup=this.formBuilder.group({_id:null,title:"",description:"",author:"",image:"",country:[null],tags:[[]],level1Category:[null],level2Category:[null],shortDescription:["",g.kI.maxLength(140)],alt1:[null],alt2:[null],alt3:[null],alt4:[null]})}setLevel1Categories(){this.categoriesService.getWikiCategories().pipe((0,h.t)(this)).subscribe(i=>{this.level1Categories=i})}setLevel2Categories(){this.formGroup.get("level1Category").valueChanges.pipe((0,h.t)(this),(0,O.h)(i=>!!i)).subscribe(i=>{this.level2Categories=this.level1Categories.find(a=>a._id===i)?.children})}getFormData(i){const a=new FormData;return Object.entries(i).filter(([,e])=>!!e).forEach(([e,s])=>{if("image"===e)Array.from(s).forEach(r=>{a.append(e,r)});else if(Array.isArray(s))s.filter(r=>!!r).forEach(r=>{a.append(e,r)});else if("object"==typeof s&&s)for(const r in s){const l=`${e}${(0,j.f)(r)}`;a.append(l,s[r])}else a.append(e,s)}),a}updateArticle(){const i=this.activatedRoute.paramMap.pipe((0,F.U)(e=>e.get("id")),(0,O.h)(e=>!!e),(0,T.w)(e=>this.blogService.getArticleById(e))),a=this.categoriesService.getWikiCategories();(0,J.a)([i,a]).pipe((0,h.t)(this)).subscribe(([e,s])=>{const r=e.category,l=s.find(C=>C?.children.find(u=>u._id===r))?._id;this.formGroup.patchValue({...e.blog,image:[$.N.apiUrl+e.blog.image?.lg],level1Category:l,level2Category:r})})}static#t=this.\u0275fac=function(a){return new(a||x)(t.Y36(g.qu),t.Y36(z.G),t.Y36(V.jE),t.Y36(p.gz),t.Y36(W.Z),t.Y36(p.F0))};static#e=this.\u0275cmp=t.Xpm({type:x,selectors:[["b2b-admin-blog-post"]],decls:27,vars:24,consts:[[1,"admin-article",3,"formGroup","ngSubmit"],[1,"admin-article__label"],["formControlName","image",1,"admin-article__image",3,"isPhoto","isClickable"],[1,"admin-article__main"],["formControlName","title","placeholder","Enter post label",1,"admin-article__input",3,"label"],["formControlName","author","placeholder","Enter post author",1,"admin-article__input",3,"label"],[1,"admin-article__categories"],[1,"admin-article__category"],["formControlName","level1Category","placeholder","Select category","bindValue","_id","bindLabel","name",3,"options","theme"],[1,"admin-article__sub-category"],["formControlName","level2Category","placeholder","Select subcategory","bindValue","_id","bindLabel","name",3,"options","theme"],[1,"admin-article__additional"],["formControlName","country","placeholder","Select Country",1,"admin-article__country",3,"theme"],[1,"admin-article__tags"],["formControlName","tags",3,"searchedOptions","searched"],["type","text","b2bNgxInput","","formControlName","shortDescription","placeholder","Enter short description of this article (up to 140 symbols)",3,"theme"],["formControlName","description",1,"admin-article__description",3,"config"],["class","image-alts",4,"ngIf"],["class","image-alts__tooltip",4,"ngIf"],["b2bNgxButton","",1,"admin-article__button",3,"theme"],[1,"image-alts"],[1,"image-alts__input"],["type","text","b2bNgxInput","","placeholder","Enter alt for picture 1","label","Alt for picture 1","formControlName","alt1",3,"theme"],["type","text","b2bNgxInput","","placeholder","Enter alt for picture 2","label","Alt for picture 2","formControlName","alt2",3,"theme"],["type","text","b2bNgxInput","","placeholder","Enter alt for picture 3","label","Alt for picture 3","formControlName","alt3",3,"theme"],["type","text","b2bNgxInput","","placeholder","Enter alt for picture 4","label","Alt for picture 4","formControlName","alt4",3,"theme"],[1,"image-alts__tooltip"]],template:function(a,e){1&a&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return e.onSubmit(e.formGroup.value)}),t.TgZ(1,"p",1),t._uU(2),t.qZA(),t.TgZ(3,"b2b-ngx-file",2),t._uU(4," Image "),t.qZA(),t.TgZ(5,"div",3),t._UZ(6,"b2b-ngx-input",4),t.ALo(7,"translate"),t._UZ(8,"b2b-ngx-input",5),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"div",6)(11,"div",7),t._UZ(12,"b2b-ngx-select",8),t.qZA(),t.TgZ(13,"div",9),t._UZ(14,"b2b-ngx-select",10),t.qZA()(),t.TgZ(15,"div",11),t._UZ(16,"b2b-ngx-country-select",12),t.TgZ(17,"div",13)(18,"b2b-ngx-chips",14),t.NdJ("searched",function(r){return e.setSearch(r)}),t.ALo(19,"async"),t.qZA()()(),t.TgZ(20,"div",3),t._UZ(21,"input",15),t.qZA(),t._UZ(22,"angular-editor",16),t.YNc(23,nt,9,4,"div",17),t.YNc(24,it,2,0,"div",18),t.TgZ(25,"button",19),t._uU(26),t.qZA()()),2&a&&(t.Q6J("formGroup",e.formGroup),t.xp6(2),t.hij(" ",e.blogAction===e.blogActionEnum.EDIT?"Edit an post":"Add an post"," "),t.xp6(1),t.Q6J("isPhoto",!0)("isClickable",!0),t.xp6(3),t.Q6J("label",t.lcZ(7,18,"LABELS.ARTICLE_LABEL")),t.xp6(2),t.Q6J("label",t.lcZ(9,20,"LABELS.ARTICLE_AUTHOR")),t.xp6(4),t.Q6J("options",e.level1Categories)("theme",e.b2bNgxSelectThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("options",e.level2Categories)("theme",e.b2bNgxSelectThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("theme",e.b2bNgxSelectThemeEnum.BACKGROUND_GRAY),t.xp6(2),t.Q6J("searchedOptions",t.lcZ(19,22,e.searchedOptions$)),t.xp6(3),t.Q6J("theme",e.b2bNgxInputThemeEnum.BACKGROUND_GRAY),t.xp6(1),t.Q6J("config",e.editorConfig),t.xp6(1),t.Q6J("ngIf",e.blogAction===e.blogActionEnum.EDIT),t.xp6(1),t.Q6J("ngIf",e.blogAction===e.blogActionEnum.CREATE),t.xp6(1),t.Q6J("theme",e.b2bNgxButtonThemeEnum.BACKGROUND_BLACK),t.xp6(1),t.hij(" ",e.formGroup.get("_id").value?"Update an post":"Create an post"," "))},dependencies:[b.O5,X.F,H.k,w.d,k.B,q.f,tt.V,P.s6,g._Y,g.Fj,g.JJ,g.JL,g.sg,g.u,et.L,b.Ov,N.X$],styles:[".admin-article[_ngcontent-%COMP%]{display:block;margin:30px;background-color:#fff;padding:60px}.admin-article[_ngcontent-%COMP%]   .image-alts__input[_ngcontent-%COMP%]{margin-top:20px}.admin-article[_ngcontent-%COMP%]   .image-alts__tooltip[_ngcontent-%COMP%]{color:#6c7077}.admin-article[_ngcontent-%COMP%]   .admin-article__image[_ngcontent-%COMP%]{display:block;margin-top:30px}.admin-article[_ngcontent-%COMP%]   .admin-article__label[_ngcontent-%COMP%]{font-weight:700;font-size:32px;color:#0f0f11}.admin-article[_ngcontent-%COMP%]   .admin-article__input[_ngcontent-%COMP%]{display:block;margin-top:30px}.admin-article[_ngcontent-%COMP%]   .admin-article__main[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.admin-article[_ngcontent-%COMP%]   .admin-article__main[_ngcontent-%COMP%]   .admin-article__input[_ngcontent-%COMP%]{width:49%}.admin-article[_ngcontent-%COMP%]   .admin-article__additional[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:30px}.admin-article[_ngcontent-%COMP%]   .admin-article__additional[_ngcontent-%COMP%]   .admin-article__country[_ngcontent-%COMP%], .admin-article[_ngcontent-%COMP%]   .admin-article__additional[_ngcontent-%COMP%]   .admin-article__tags[_ngcontent-%COMP%]{width:49%}.admin-article[_ngcontent-%COMP%]   .admin-article__categories[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:30px}.admin-article[_ngcontent-%COMP%]   .admin-article__categories[_ngcontent-%COMP%]   .admin-article__category[_ngcontent-%COMP%], .admin-article[_ngcontent-%COMP%]   .admin-article__categories[_ngcontent-%COMP%]   .admin-article__sub-category[_ngcontent-%COMP%]{width:49%}.admin-article[_ngcontent-%COMP%]   .admin-article__button[_ngcontent-%COMP%]{margin-top:30px;padding:15px 40px}  .angular-editor-textarea img{max-width:100%}  .angular-editor-textarea p{line-height:24px}  .ngx-files-list-item{margin-top:0!important}  .admin-article__description{display:block;margin-top:30px;overflow:hidden;line-height:24px}  .admin-article__description span,   .admin-article__description p{line-height:24px}  .admin-article__description ul,   .admin-article__description li{list-style:disc!important}  .admin-article__description ul{padding-left:30px}  .admin-article__description strong,   .admin-article__description b{font-weight:700!important}  .admin-article__description img{width:100%}"],changeDetection:0})};return o=(0,R.gn)([(0,h.c)()],o),o})()}];let lt=(()=>{class o{static#t=this.\u0275fac=function(a){return new(a||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[p.Bz.forChild(at),p.Bz]})}return o})(),rt=(()=>{class o{static#t=this.\u0275fac=function(a){return new(a||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[b.ez,lt,_.r,S.y,I.F,M.l,B.N,P.UM,g.UX,Z.v,N.aw]})}return o})()}}]);